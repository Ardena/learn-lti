<div class='row'>
  <% if @test[:type] == :fill_in || @test[:type] == :redirect || @test[:type] == :xml || @test[:type] == :grade_passback %>
  <div class='span6'>
    <h2><%= @activity.id %></h2>
    <p><%= @activity.intro %></p>
    <div class="pagination">
      <ul>
        <% if @index == 0 %>
          <li class="disabled"><a>&laquo;</a></li>
        <% else %>
          <li class=""><a href="/launch/<%= params['activity'] %>/<%= @index - 1 %>">&laquo;</a></li>
        <% end %>
        <li class=""><a>Lesson <%= @index + 1 %></a></li>
        <% if @next_enabled %>
          <li class=""><a href="/launch/<%= params['activity'] %>/<%= @index + 1 %>">&raquo;</a></li>
        <% else %>
          <li class="disabled"><a>&raquo;</a></li>
        <% end %>
      </ul>
    </div>
    <h3><%= @test[:args][:key] %></h3>
    <p>
      <%= @test[:args][:explanation] %>
    </p>
  </div>
    
    <div class='span5 well'>
      Key: <span id='consumer_key'><%= session['key'] %></span><br/>
      Secret: <span id='shared_secret'><%= session['secret'] %></span><br/>
      <% if @test[:type] == :xml %>
        <form method="POST" action="/validate/<%= params['activity'] %>/<%= @index %>" id="answer" class="form-inline">
          <label for="answer">XML Content:
          </label><br/>
          <textarea id="answer" name="answer" class="span5" style="height: 200px;"></textarea><br/>
          <button type="submit" class='btn hideable'>Confirm</button>
        </form>
      <% else %>
        <form method="POST" action="/test/<%= params['activity'] %>/<%= @index %>" id="launch" target="app_launch" class="form-inline">
          <label>
            launch URL:
            <input type="text" name="launch_url" value="<%= session['launch_url'] %>" style="width: 200px;"/>
          </label>
          <button type="submit" class='btn'>Launch</button>
        </form>
        <iframe id="app_launch" frameborder="0" style="border: 2px solid #333; width: 100%; height: 300px;" src="about:blank"></iframe>
        <% if @test[:type] == :fill_in %>
          <form method="POST" action="/validate/<%= params['activity'] %>/<%= @index %>" id="answer" class="form-inline" style="display: none;">
            <% if @test[:args][:pick_roles] %>
              roles passed at launch:
              <ul>
                <li><label><input type="checkbox" name="role[]" value="Teacher"/> Teacher</label></li>
                <li><label><input type="checkbox" name="role[]" value="Student"/> Student</label></li>
                <li><label><input type="checkbox" name="role[]" value="Observer"/> Observer</label></li>
                <li><label><input type="checkbox" name="role[]" value="Designer"/> Designer</label></li>
                <li><label><input type="checkbox" name="role[]" value="Admin"/> Admin</label></li>
              </ul>
            <% elsif @test[:args][:pick_valid] %>
              <label>
                was the value sent for <code><%= @test[:args][:param] %></code> valid?
                <select name="valid">
                  <option>Yes</option>
                  <option>No</option>
                </select>
              </label>
            <% else %>
              <label>
                value for <code><%= @test[:args][:param] %></code>:<br/>
                <input type="text" name="answer" id="answer_value" class='hideable'/>
              </label>
            <% end %>
            <button type="submit" class='btn hideable'>Confirm</button>
          </form>
        <% elsif @test[:type] == :redirect %>
          <div id="answer">
            <div class="waiting">
              Waiting for redirect...
            </div>
          </div>
        <% elsif @test[:type] == :grade_passback %>
          <form method="POST" action="/validate/<%= params['activity'] %>/<%= @index %>" id="answer" class="form-inline" style="display: none;">
            Click "Confirm" once you think grades have been passed back
            <button type="submit" class='btn hideable'>Confirm</button>
          </form>
        <% end %>
      <% end %>
      <div id="results"></div>
    </div>
    
  <% end %>
</div>
